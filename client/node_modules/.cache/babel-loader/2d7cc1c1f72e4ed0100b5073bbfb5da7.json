{"ast":null,"code":"'use strict';\n\nconst promisify = require('promisify-es6');\n\nconst Block = require('ipfs-block');\n\nconst CID = require('cids');\n\nconst multihash = require('multihashes');\n\nconst SendOneFile = require('../utils/send-one-file');\n\nmodule.exports = send => {\n  const sendOneFile = SendOneFile(send, 'block/put');\n  return promisify((block, options, callback) => {\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n\n    options = options || {};\n\n    if (Array.isArray(block)) {\n      return callback(new Error('block.put accepts only one block'));\n    }\n\n    if (Buffer.isBuffer(block)) {\n      block = {\n        data: block\n      };\n    }\n\n    if (!block || !block.data) {\n      return callback(new Error('invalid block arg'));\n    }\n\n    const qs = {};\n\n    if (block.cid || options.cid) {\n      let cid;\n\n      try {\n        cid = new CID(block.cid || options.cid);\n      } catch (err) {\n        return callback(err);\n      }\n\n      const {\n        name,\n        length\n      } = multihash.decode(cid.multihash);\n      qs.format = cid.codec;\n      qs.mhtype = name;\n      qs.mhlen = length;\n      qs.version = cid.version;\n    } else {\n      if (options.format) qs.format = options.format;\n      if (options.mhtype) qs.mhtype = options.mhtype;\n      if (options.mhlen) qs.mhlen = options.mhlen;\n      if (options.version != null) qs.version = options.version;\n    }\n\n    sendOneFile(block.data, {\n      qs\n    }, (err, result) => {\n      if (err) {\n        // Retry with \"protobuf\"/\"cbor\" format for go-ipfs\n        // TODO: remove when https://github.com/ipfs/go-cid/issues/75 resolved\n        if (qs.format === 'dag-pb' || qs.format === 'dag-cbor') {\n          qs.format = qs.format === 'dag-pb' ? 'protobuf' : 'cbor';\n          return sendOneFile(block.data, {\n            qs\n          }, (err, result) => {\n            if (err) return callback(err);\n            callback(null, new Block(block.data, new CID(result.Key)));\n          });\n        }\n\n        return callback(err);\n      }\n\n      callback(null, new Block(block.data, new CID(result.Key)));\n    });\n  });\n};","map":{"version":3,"names":["promisify","require","Block","CID","multihash","SendOneFile","module","exports","send","sendOneFile","block","options","callback","Array","isArray","Error","Buffer","isBuffer","data","qs","cid","err","name","length","decode","format","codec","mhtype","mhlen","version","result","Key"],"sources":["C:/Users/Shreyas/Desktop/DMR-master/client/node_modules/ipfs-http-client/src/block/put.js"],"sourcesContent":["'use strict'\n\nconst promisify = require('promisify-es6')\nconst Block = require('ipfs-block')\nconst CID = require('cids')\nconst multihash = require('multihashes')\nconst SendOneFile = require('../utils/send-one-file')\n\nmodule.exports = (send) => {\n  const sendOneFile = SendOneFile(send, 'block/put')\n\n  return promisify((block, options, callback) => {\n    if (typeof options === 'function') {\n      callback = options\n      options = {}\n    }\n\n    options = options || {}\n\n    if (Array.isArray(block)) {\n      return callback(new Error('block.put accepts only one block'))\n    }\n\n    if (Buffer.isBuffer(block)) {\n      block = { data: block }\n    }\n\n    if (!block || !block.data) {\n      return callback(new Error('invalid block arg'))\n    }\n\n    const qs = {}\n\n    if (block.cid || options.cid) {\n      let cid\n\n      try {\n        cid = new CID(block.cid || options.cid)\n      } catch (err) {\n        return callback(err)\n      }\n\n      const { name, length } = multihash.decode(cid.multihash)\n\n      qs.format = cid.codec\n      qs.mhtype = name\n      qs.mhlen = length\n      qs.version = cid.version\n    } else {\n      if (options.format) qs.format = options.format\n      if (options.mhtype) qs.mhtype = options.mhtype\n      if (options.mhlen) qs.mhlen = options.mhlen\n      if (options.version != null) qs.version = options.version\n    }\n\n    sendOneFile(block.data, { qs }, (err, result) => {\n      if (err) {\n        // Retry with \"protobuf\"/\"cbor\" format for go-ipfs\n        // TODO: remove when https://github.com/ipfs/go-cid/issues/75 resolved\n        if (qs.format === 'dag-pb' || qs.format === 'dag-cbor') {\n          qs.format = qs.format === 'dag-pb' ? 'protobuf' : 'cbor'\n          return sendOneFile(block.data, { qs }, (err, result) => {\n            if (err) return callback(err)\n            callback(null, new Block(block.data, new CID(result.Key)))\n          })\n        }\n\n        return callback(err)\n      }\n\n      callback(null, new Block(block.data, new CID(result.Key)))\n    })\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}