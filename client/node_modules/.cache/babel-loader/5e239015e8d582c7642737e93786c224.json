{"ast":null,"code":"'use strict';\n\nconst {\n  ensureMultiaddr\n} = require('./utils');\n\nconst uniqBy = require('unique-by'); // Because JavaScript doesn't let you overload the compare in Set()..\n\n\nclass MultiaddrSet {\n  constructor(multiaddrs) {\n    this._multiaddrs = multiaddrs || [];\n    this._observedMultiaddrs = [];\n  }\n\n  add(ma) {\n    ma = ensureMultiaddr(ma);\n\n    if (!this.has(ma)) {\n      this._multiaddrs.push(ma);\n    }\n  } // addSafe - prevent multiaddr explosion™\n  // Multiaddr explosion is when you dial to a bunch of nodes and every node\n  // gives you a different observed address and you start storing them all to\n  // share with other peers. This seems like a good idea until you realize that\n  // most of those addresses are unique to the subnet that peer is in and so,\n  // they are completely worthless for all the other peers. This method is\n  // exclusively used by identify.\n\n\n  addSafe(ma) {\n    ma = ensureMultiaddr(ma);\n\n    const check = this._observedMultiaddrs.some((m, i) => {\n      if (m.equals(ma)) {\n        this.add(ma);\n\n        this._observedMultiaddrs.splice(i, 1);\n\n        return true;\n      }\n    });\n\n    if (!check) {\n      this._observedMultiaddrs.push(ma);\n    }\n  }\n\n  toArray() {\n    return this._multiaddrs.slice();\n  }\n\n  get size() {\n    return this._multiaddrs.length;\n  }\n\n  forEach(fn) {\n    return this._multiaddrs.forEach(fn);\n  }\n\n  filterBy(maFmt) {\n    if (typeof maFmt !== 'object' || typeof maFmt.matches !== 'function' || typeof maFmt.partialMatch !== 'function' || typeof maFmt.toString !== 'function') return [];\n    return this._multiaddrs.filter(ma => maFmt.matches(ma));\n  }\n\n  has(ma) {\n    ma = ensureMultiaddr(ma);\n    return this._multiaddrs.some(m => m.equals(ma));\n  }\n\n  delete(ma) {\n    ma = ensureMultiaddr(ma);\n\n    this._multiaddrs.some((m, i) => {\n      if (m.equals(ma)) {\n        this._multiaddrs.splice(i, 1);\n\n        return true;\n      }\n    });\n  } // replaces selected existing multiaddrs with new ones\n\n\n  replace(existing, fresh) {\n    if (!Array.isArray(existing)) {\n      existing = [existing];\n    }\n\n    if (!Array.isArray(fresh)) {\n      fresh = [fresh];\n    }\n\n    existing.forEach(m => this.delete(m));\n    fresh.forEach(m => this.add(m));\n  }\n\n  clear() {\n    this._multiaddrs = [];\n  } // this only really helps make ip6 and ip4 multiaddrs distinct if they are\n  // different\n  // TODO this is not an ideal solution, probably this code should just be\n  // in libp2p-tcp\n\n\n  distinct() {\n    return uniqBy(this._multiaddrs, ma => {\n      return [ma.toOptions().port, ma.toOptions().transport].join();\n    });\n  }\n\n}\n\nmodule.exports = MultiaddrSet;","map":{"version":3,"names":["ensureMultiaddr","require","uniqBy","MultiaddrSet","constructor","multiaddrs","_multiaddrs","_observedMultiaddrs","add","ma","has","push","addSafe","check","some","m","i","equals","splice","toArray","slice","size","length","forEach","fn","filterBy","maFmt","matches","partialMatch","toString","filter","delete","replace","existing","fresh","Array","isArray","clear","distinct","toOptions","port","transport","join","module","exports"],"sources":["C:/Users/Shreyas/Desktop/DREAMS/DMR-master/DREAMS-system/client/node_modules/peer-info/src/multiaddr-set.js"],"sourcesContent":["'use strict'\n\nconst { ensureMultiaddr } = require('./utils')\nconst uniqBy = require('unique-by')\n\n// Because JavaScript doesn't let you overload the compare in Set()..\nclass MultiaddrSet {\n  constructor (multiaddrs) {\n    this._multiaddrs = multiaddrs || []\n    this._observedMultiaddrs = []\n  }\n\n  add (ma) {\n    ma = ensureMultiaddr(ma)\n\n    if (!this.has(ma)) {\n      this._multiaddrs.push(ma)\n    }\n  }\n\n  // addSafe - prevent multiaddr explosion™\n  // Multiaddr explosion is when you dial to a bunch of nodes and every node\n  // gives you a different observed address and you start storing them all to\n  // share with other peers. This seems like a good idea until you realize that\n  // most of those addresses are unique to the subnet that peer is in and so,\n  // they are completely worthless for all the other peers. This method is\n  // exclusively used by identify.\n  addSafe (ma) {\n    ma = ensureMultiaddr(ma)\n\n    const check = this._observedMultiaddrs.some((m, i) => {\n      if (m.equals(ma)) {\n        this.add(ma)\n        this._observedMultiaddrs.splice(i, 1)\n        return true\n      }\n    })\n    if (!check) {\n      this._observedMultiaddrs.push(ma)\n    }\n  }\n\n  toArray () {\n    return this._multiaddrs.slice()\n  }\n\n  get size () {\n    return this._multiaddrs.length\n  }\n\n  forEach (fn) {\n    return this._multiaddrs.forEach(fn)\n  }\n\n  filterBy (maFmt) {\n    if (typeof maFmt !== 'object' ||\n      typeof maFmt.matches !== 'function' ||\n      typeof maFmt.partialMatch !== 'function' ||\n      typeof maFmt.toString !== 'function') return []\n\n    return this._multiaddrs.filter((ma) => maFmt.matches(ma))\n  }\n\n  has (ma) {\n    ma = ensureMultiaddr(ma)\n    return this._multiaddrs.some((m) => m.equals(ma))\n  }\n\n  delete (ma) {\n    ma = ensureMultiaddr(ma)\n\n    this._multiaddrs.some((m, i) => {\n      if (m.equals(ma)) {\n        this._multiaddrs.splice(i, 1)\n        return true\n      }\n    })\n  }\n\n  // replaces selected existing multiaddrs with new ones\n  replace (existing, fresh) {\n    if (!Array.isArray(existing)) {\n      existing = [existing]\n    }\n    if (!Array.isArray(fresh)) {\n      fresh = [fresh]\n    }\n    existing.forEach((m) => this.delete(m))\n    fresh.forEach((m) => this.add(m))\n  }\n\n  clear () {\n    this._multiaddrs = []\n  }\n\n  // this only really helps make ip6 and ip4 multiaddrs distinct if they are\n  // different\n  // TODO this is not an ideal solution, probably this code should just be\n  // in libp2p-tcp\n  distinct () {\n    return uniqBy(this._multiaddrs, (ma) => {\n      return [ma.toOptions().port, ma.toOptions().transport].join()\n    })\n  }\n}\n\nmodule.exports = MultiaddrSet\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAsBC,OAAO,CAAC,SAAD,CAAnC;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,WAAD,CAAtB,C,CAEA;;;AACA,MAAME,YAAN,CAAmB;EACjBC,WAAW,CAAEC,UAAF,EAAc;IACvB,KAAKC,WAAL,GAAmBD,UAAU,IAAI,EAAjC;IACA,KAAKE,mBAAL,GAA2B,EAA3B;EACD;;EAEDC,GAAG,CAAEC,EAAF,EAAM;IACPA,EAAE,GAAGT,eAAe,CAACS,EAAD,CAApB;;IAEA,IAAI,CAAC,KAAKC,GAAL,CAASD,EAAT,CAAL,EAAmB;MACjB,KAAKH,WAAL,CAAiBK,IAAjB,CAAsBF,EAAtB;IACD;EACF,CAZgB,CAcjB;EACA;EACA;EACA;EACA;EACA;EACA;;;EACAG,OAAO,CAAEH,EAAF,EAAM;IACXA,EAAE,GAAGT,eAAe,CAACS,EAAD,CAApB;;IAEA,MAAMI,KAAK,GAAG,KAAKN,mBAAL,CAAyBO,IAAzB,CAA8B,CAACC,CAAD,EAAIC,CAAJ,KAAU;MACpD,IAAID,CAAC,CAACE,MAAF,CAASR,EAAT,CAAJ,EAAkB;QAChB,KAAKD,GAAL,CAASC,EAAT;;QACA,KAAKF,mBAAL,CAAyBW,MAAzB,CAAgCF,CAAhC,EAAmC,CAAnC;;QACA,OAAO,IAAP;MACD;IACF,CANa,CAAd;;IAOA,IAAI,CAACH,KAAL,EAAY;MACV,KAAKN,mBAAL,CAAyBI,IAAzB,CAA8BF,EAA9B;IACD;EACF;;EAEDU,OAAO,GAAI;IACT,OAAO,KAAKb,WAAL,CAAiBc,KAAjB,EAAP;EACD;;EAEO,IAAJC,IAAI,GAAI;IACV,OAAO,KAAKf,WAAL,CAAiBgB,MAAxB;EACD;;EAEDC,OAAO,CAAEC,EAAF,EAAM;IACX,OAAO,KAAKlB,WAAL,CAAiBiB,OAAjB,CAAyBC,EAAzB,CAAP;EACD;;EAEDC,QAAQ,CAAEC,KAAF,EAAS;IACf,IAAI,OAAOA,KAAP,KAAiB,QAAjB,IACF,OAAOA,KAAK,CAACC,OAAb,KAAyB,UADvB,IAEF,OAAOD,KAAK,CAACE,YAAb,KAA8B,UAF5B,IAGF,OAAOF,KAAK,CAACG,QAAb,KAA0B,UAH5B,EAGwC,OAAO,EAAP;IAExC,OAAO,KAAKvB,WAAL,CAAiBwB,MAAjB,CAAyBrB,EAAD,IAAQiB,KAAK,CAACC,OAAN,CAAclB,EAAd,CAAhC,CAAP;EACD;;EAEDC,GAAG,CAAED,EAAF,EAAM;IACPA,EAAE,GAAGT,eAAe,CAACS,EAAD,CAApB;IACA,OAAO,KAAKH,WAAL,CAAiBQ,IAAjB,CAAuBC,CAAD,IAAOA,CAAC,CAACE,MAAF,CAASR,EAAT,CAA7B,CAAP;EACD;;EAEDsB,MAAM,CAAEtB,EAAF,EAAM;IACVA,EAAE,GAAGT,eAAe,CAACS,EAAD,CAApB;;IAEA,KAAKH,WAAL,CAAiBQ,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;MAC9B,IAAID,CAAC,CAACE,MAAF,CAASR,EAAT,CAAJ,EAAkB;QAChB,KAAKH,WAAL,CAAiBY,MAAjB,CAAwBF,CAAxB,EAA2B,CAA3B;;QACA,OAAO,IAAP;MACD;IACF,CALD;EAMD,CAvEgB,CAyEjB;;;EACAgB,OAAO,CAAEC,QAAF,EAAYC,KAAZ,EAAmB;IACxB,IAAI,CAACC,KAAK,CAACC,OAAN,CAAcH,QAAd,CAAL,EAA8B;MAC5BA,QAAQ,GAAG,CAACA,QAAD,CAAX;IACD;;IACD,IAAI,CAACE,KAAK,CAACC,OAAN,CAAcF,KAAd,CAAL,EAA2B;MACzBA,KAAK,GAAG,CAACA,KAAD,CAAR;IACD;;IACDD,QAAQ,CAACV,OAAT,CAAkBR,CAAD,IAAO,KAAKgB,MAAL,CAAYhB,CAAZ,CAAxB;IACAmB,KAAK,CAACX,OAAN,CAAeR,CAAD,IAAO,KAAKP,GAAL,CAASO,CAAT,CAArB;EACD;;EAEDsB,KAAK,GAAI;IACP,KAAK/B,WAAL,GAAmB,EAAnB;EACD,CAvFgB,CAyFjB;EACA;EACA;EACA;;;EACAgC,QAAQ,GAAI;IACV,OAAOpC,MAAM,CAAC,KAAKI,WAAN,EAAoBG,EAAD,IAAQ;MACtC,OAAO,CAACA,EAAE,CAAC8B,SAAH,GAAeC,IAAhB,EAAsB/B,EAAE,CAAC8B,SAAH,GAAeE,SAArC,EAAgDC,IAAhD,EAAP;IACD,CAFY,CAAb;EAGD;;AAjGgB;;AAoGnBC,MAAM,CAACC,OAAP,GAAiBzC,YAAjB"},"metadata":{},"sourceType":"script"}